:82 {
    redir https://swust.devin.cool permanent
    log
}

swust.devin.cool {

    handle_path /api/v2/extension/cr {
        reverse_proxy 172.17.0.1:8000
        header_down +Access-Control-Allow-Origin *
        header_down +Access-Control-Allow-Methods *
        header_down +Access-Control-Allow-Headers *
    }

    handle_path /api/hitokoto {
        reverse_proxy hitokoto_api:8000
    }
    reverse_proxy /api/v2/login/* {
        to backend:8080 10.13.13.2:8080
        lb_policy first
        health_uri /api/v2/test/ping
        health_interval 10s
        health_timeout 2s
        health_status 2xx

        header_down +Access-Control-Allow-Origin *
        header_down +Access-Control-Allow-Methods *
        header_down +Access-Control-Allow-Headers *
    }
    reverse_proxy /api/* {
        to backend:8080 10.13.13.2:8080
        lb_policy random
        health_uri /api/v2/test/ping
        health_interval 10s
        health_timeout 2s
        health_status 2xx
        header_down +Access-Control-Allow-Origin *
        header_down +Access-Control-Allow-Methods *
        header_down +Access-Control-Allow-Headers *
    }
    handle_path /plugins/* {
        handle_path /djs/*  {
            rewrite * /djs/{path}
            reverse_proxy 172.17.0.1:50002
        }
        handle_path /dfy* {
            rewrite * /
            reverse_proxy 172.17.0.1:50002
        }
        handle_path /homework* {
            rewrite * /plugins/homework
            reverse_proxy 172.17.0.1:50001
        }
        root * /swust/plugins
    }
    root * /swust
    file_server
    encode zstd gzip
    log
}

update.devin.cool {
    root * /files
    file_server browse
    log
}

:50002 {
    root * /mht/dist
    reverse_proxy /homework* 172.17.0.1:50001
    file_server
    log
}
